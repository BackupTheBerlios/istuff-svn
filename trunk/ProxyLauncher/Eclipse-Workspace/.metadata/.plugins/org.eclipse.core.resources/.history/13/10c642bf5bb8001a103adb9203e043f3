import java.io.File;
import java.io.IOException;

import javax.swing.JTextArea;

import org.jdom.Document;
import org.jdom.Element;
import org.jdom.JDOMException;
import org.jdom.input.SAXBuilder;

public class EventHeapThread extends Thread implements Runnable{
	
	private File _pathToEventHeap;

	public EventHeapThread () {
		
		// The path to the iROS package and the Event Heap location is read dynamically
		// out of the config XML file.

		SAXBuilder builder = new SAXBuilder();
		File configFile = new File("configStarter.xml");
		Document docWithConfig = new Document();
		try {
			docWithConfig = builder.build(configFile);
			Element xmlFileRoot = docWithConfig.getRootElement();
			if (xmlFileRoot != null)
				_pathToEventHeap = new File(xmlFileRoot.getChild("EventHeapLocation").getValue());
		} catch (JDOMException e) {
			e.printStackTrace();
		} catch (IOException e) {
			System.out.println("Corrupt XML file");
		}
	}

	}
	
	public void run()
	  {
			try {
				File env = new File(_xmlRoot.getChild("EventHeapLocation").getValue());
				// Construct launch commnand for the event heap
				// from the information in the XML file.
				String iROSLoc = _xmlRoot.getChild("Libraries").getChild("iROS").getValue();
				//String jmdnsLoc = _xmlRoot.getChild("Libraries").getChild("JmDNS").getValue();
				String cmd = "java -cp " + iROSLoc 
				+ _separator + jmdnsLoc + " "
				+ "iwork.eheap2.server.EventHeapServer";
				if (_startLocalEHButton.isSelected()) {
				_startLocalEHButton.setText("Stop local EH");
				// lock the button until the service is actually running.
				_startLocalEHButton.setEnabled(false);
				try {
					_ehProcess = Runtime.getRuntime().exec(cmd, null, env);
					System.out.println("Eh is running");
				} catch (IOException e1) {
					e1.printStackTrace();
				}
			} else {
				_startLocalEHButton.setText("Start local EH");
				System.out.println("EH stopped");
				_ehProcess.destroy();
			}
		  
		  File env = new File("/Users/rene/DiplomaThesis/Programming/trunk/Event\\ Heap");
		  System.out.println("Env Path: " + env);
		  try {
			   Process _ehProcess = Runtime.getRuntime().exec(
					  "java -cp ../Lib/iROS.jar:../Lib/jmdns.jar iwork.eheap2.server.EventHeapServer",null,env);
		  }
		  catch (IOException e) {
			e.printStackTrace();
		}

	  }

}
