import java.io.File;
import java.io.IOException;

import javax.swing.JTextArea;

import org.jdom.Document;
import org.jdom.Element;
import org.jdom.JDOMException;
import org.jdom.input.SAXBuilder;

public class EventHeapThread extends Thread implements Runnable{
	
	private File _pathToEventHeap;

	public void run()  {
		// The path to the iROS package and the Event Heap location is read dynamically
		// out of the config XML file.

		// It must be differentiated between the different OS because the syntax
		// of the JAVA Compiler call is a little different.
		String separator;
		
			if (System.getProperty("os.name").contains("Windows"))
				separator = ";";
			else
				separator = ":";
		
		SAXBuilder builder = new SAXBuilder();
		File configFile = new File("configStarter.xml");
			Document docWithConfig = new Document();
		try {
			docWithConfig = builder.build(configFile);
			Element xmlFileRoot = docWithConfig.getRootElement();
			if (xmlFileRoot != null) {
				_pathToEventHeap = new File(xmlFileRoot.getChild("EventHeapLocation").getValue());
				File env = new File(xmlFileRoot.getChild("EventHeapLocation").getValue());
				// Construct launch commnand for the event heap
				// from the information in the XML file.
				String iROSLoc = xmlFileRoot.getChild("Libraries").getChild("iROS").getValue();
				String jmdnsLoc = xmlFileRoot.getChild("Libraries").getChild("JmDNS").getValue();
				String cmd = "java -cp " + iROSLoc + separator + jmdnsLoc + " "
				+ "iwork.eheap2.server.EventHeapServer";
				try {
					Process _ehProcess = Runtime.getRuntime().exec(cmd, null, env);
					System.out.println("Eh is running");
				} catch (IOException e1) {
					e1.printStackTrace();
				}
			}
		} catch (JDOMException e) {
			e.printStackTrace();
		} catch (IOException e) {
			System.out.println("Corrupt XML file");
		}
	}
}
