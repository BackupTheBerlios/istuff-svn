<html>
<head>
 
<title>TELEO APPLICATION SDK</title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<link rel="stylesheet" href="code.css" type="text/css">
</head>

<body bgcolor="#FFFFFF" text="#000000" link="619ec3" vlink="619ec3" alink="619ec3">

<table width="100%" border="0" cellspacing="0" cellpadding="-1">
  <tr> 
    <td width="1%" rowspan="2" bgcolor="#FFFFFF" valign="top"><a href="/index.htm"><img src="images/logo_header_blue.jpg" width="263" height="123" border="0"></a></td>
    <td height="109" bgcolor="395e7a" width="100%" valign="bottom" align="left"> 
      <p>&nbsp;</p>
      <table width="100%" border="0">
        <tr> 
          <td width="20%" height="20" class="medium_bold"> 
            <div align="center">
              <font color="619ec3" class="medium_bold"><a href="http://www.makingthings.com/home.htm">HOME</a></font>
            </div>
          </td>
          <td width="20%" height="20" class="medium_bold"> 
            <div align="center"><font color="619ec3" class="medium_bold"><a href="http://www.makingthings.com/projects.htm">PROJECTS</a></font></div>
          </td>
          <td width="20%" height="20" class="medium_bold"> 
            <div align="center"><font color="#FFFFFF" class="medium_bold"><b class="medium_bold">PRODUCTS</b></font></div>
          </td>
          <td width="20%" class="medium_bold" height="20"> 
            <div align="center"><font color="619ec3" class="medium_bold"><a href="http://www.makingthings.com/services.htm">SERVICES</a></font></div>
          </td>
          <td width="20%" class="medium_bold" height="20"> 
            <div align="center"><font color="619ec3" class="medium_bold"><a href="http://www.makingthings.com/news/news.htm">NEWS</a></font></div>
          </td>
        </tr>
      </table>
    </td>
  </tr>
  <tr> 
    <td width="100%" height="15">&nbsp;</td>
  </tr>
  <tr align="left" valign="middle"> 
    <td colspan="2"></td>
  </tr>
</table> 
<br>
<hr>

<font face="Arial, Helvetica, sans-serif" size="2">


<!-- Generated by Doxygen 1.3-rc3 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="annotated.html">Data Structures</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Data Fields</a> &nbsp; <a class="qindex" href="globals.html">Globals</a> &nbsp; </center>
<hr><h1>TeleoInterfaceMacOSX.c</h1><a href="TeleoInterfaceMacOSX_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">/* Copyright 2003 MakingThings LLC. */</span>
00002 
00007 <span class="preprocessor">#include &lt;fcntl.h&gt;</span>
00008 <span class="preprocessor">#include &lt;termios.h&gt;</span>
00009 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
00010 <span class="preprocessor">#include &lt;string.h&gt;</span>
00011 <span class="preprocessor">#include &lt;unistd.h&gt;</span>
00012 <span class="preprocessor">#include &lt;errno.h&gt;</span>
00013 
00014 <span class="comment">// for scandir</span>
00015 <span class="preprocessor">#include &lt;sys/types.h&gt;</span>
00016 <span class="preprocessor">#include &lt;dirent.h&gt;</span>
00017 
00018 <span class="preprocessor">#include "<a class="code" href="TeleoInterface_8h.html">TeleoInterface.h</a>"</span>
00019 
00020 <span class="comment">// Forward local function declarations</span>
00021 
00022 <span class="comment">// TeleoChannel Device Finder</span>
00026 <span class="comment"></span><span class="keyword">static</span> <a class="code" href="TeleoError_8h.html#a20">TeleoError</a> <a class="code" href="TeleoModuleMacOSX_8c.html#a12">TI_FindUsbSerialDevice</a>(cchar** dest, <span class="keywordtype">int</span> index);
00027 
00028 <span class="comment">// routine used to select matches in scandir</span>
00032 <span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="TeleoModuleMacOSX_8c.html#a13">matchUsbSerialDevice</a> (<span class="keyword">struct</span> dirent * tryThis);
00033 
00038 <span class="keyword">typedef</span> <span class="keyword">struct </span>
00039 <span class="keyword"></span>{
00040   <a class="code" href="structTeleoInterface.html">TeleoInterface</a> t;
00041   
00042   <a class="code" href="TeleoInterface_8h.html#a21">TI_InterfaceType</a> interfaceType;  
<a name="l00043"></a><a class="code" href="structTeleoInterfaceInt.html#m7">00043</a>   <span class="keywordtype">char</span> * name;                     
00044   
<a name="l00045"></a><a class="code" href="structTeleoInterfaceInt.html#m3">00045</a>   <span class="keywordtype">int</span> deviceHandle;                
00046   
00047   <span class="keywordtype">bool</span> blocking;                   
00048 
00049   <span class="comment">// (ultimately) Union of all the different support data structures</span>
<a name="l00050"></a><a class="code" href="structTeleoInterfaceInt.html#m8">00050</a>   <span class="keyword">struct </span>termios terminalSettings;    
<a name="l00051"></a><a class="code" href="structTeleoInterfaceInt.html#m9">00051</a>   <span class="keyword">struct </span>termios terminalSettingsOld; 
00052 
00053 } <a class="code" href="structTeleoInterfaceInt.html">TeleoInterfaceInt</a>;
00054 
<a name="l00055"></a><a class="code" href="TeleoInterfaceMacOSX_8c.html#a2">00055</a> <a class="code" href="TeleoError_8h.html#a20">TeleoError</a> <a class="code" href="TeleoInterfaceLinux_8c.html#a0">TI_Create</a>( cchar* name, TI_InterfaceType interfaceType, <a class="code" href="structTeleoInterface.html">TeleoInterface</a>** ti )
00056 {
00057   TeleoInterfaceInt* teleoInterfaceP;
00058   <a class="code" href="TeleoError_8h.html#a20">TeleoError</a> teleoError;
00059 
00060   *ti = NULL;
00061   
00062   teleoInterfaceP = (TeleoInterfaceInt*)malloc( <span class="keyword">sizeof</span>( TeleoInterfaceInt ) );
00063   <span class="keywordflow">if</span> ( teleoInterfaceP == NULL )
00064     <span class="keywordflow">return</span> <a class="code" href="TeleoError_8h.html#a20a16">TELEO_E_ALLOC</a>;
00065   memset( teleoInterfaceP, 0, <span class="keyword">sizeof</span>( TeleoInterfaceInt ) );
00066 
00067   <span class="keywordflow">if</span> ( name == NULL )
00068   {
00069     <span class="keywordflow">switch</span> ( interfaceType )
00070     {
00071       <span class="keywordflow">case</span> <a class="code" href="TeleoInterface_8h.html#a21a0">TI_USB</a>:
00072       <span class="keywordflow">case</span> <a class="code" href="TeleoInterface_8h.html#a21a1">TI_USB0</a>:
00073         <span class="keywordflow">if</span> (<a class="code" href="TeleoError_8h.html#a20a0">TELEO_OK</a> != ( teleoError = <a class="code" href="TeleoModuleMacOSX_8c.html#a12">TI_FindUsbSerialDevice</a>(&amp;name, 0) ) )
00074     <span class="keywordflow">return</span> ( teleoError );
00075         <span class="keywordflow">break</span>;
00076       <span class="keywordflow">case</span> <a class="code" href="TeleoInterface_8h.html#a21a2">TI_USB1</a>:
00077         <span class="keywordflow">if</span> (<a class="code" href="TeleoError_8h.html#a20a0">TELEO_OK</a> != ( teleoError = <a class="code" href="TeleoModuleMacOSX_8c.html#a12">TI_FindUsbSerialDevice</a>(&amp;name, 1) ) )
00078     <span class="keywordflow">return</span> ( teleoError );
00079         <span class="keywordflow">break</span>;
00080       <span class="keywordflow">case</span> <a class="code" href="TeleoInterface_8h.html#a21a3">TI_USB2</a>:
00081         <span class="keywordflow">if</span> (<a class="code" href="TeleoError_8h.html#a20a0">TELEO_OK</a> != ( teleoError = <a class="code" href="TeleoModuleMacOSX_8c.html#a12">TI_FindUsbSerialDevice</a>(&amp;name, 2) ) )
00082     <span class="keywordflow">return</span> ( teleoError );
00083         <span class="keywordflow">break</span>;
00084       <span class="keywordflow">default</span>:
00085         name = <span class="stringliteral">""</span>;
00086     }
00087   }
00088 
00089   <span class="keywordflow">if</span> ( name != NULL )
00090     teleoInterfaceP-&gt;<a class="code" href="structTeleoInterfaceInt.html#m2">name</a> = strdup( name );
00091   
00092   teleoInterfaceP-&gt;<a class="code" href="structTeleoInterfaceInt.html#m1">interfaceType</a> = interfaceType;
00093   
00094   teleoInterfaceP-&gt;<a class="code" href="structTeleoInterfaceInt.html#m4">blocking</a> = <span class="keyword">false</span>;
00095 
00096   *ti = (<a class="code" href="structTeleoInterface.html">TeleoInterface</a>*)teleoInterfaceP;
00097   <span class="keywordflow">return</span> <a class="code" href="TeleoError_8h.html#a20a0">TELEO_OK</a>;
00098 }
00099 
<a name="l00100"></a><a class="code" href="TeleoInterfaceMacOSX_8c.html#a3">00100</a> <a class="code" href="TeleoError_8h.html#a20">TeleoError</a> <a class="code" href="TeleoInterfaceLinux_8c.html#a2">TI_nameGet</a>( <a class="code" href="structTeleoInterface.html">TeleoInterface</a>* ti, cchar** name )
00101 {
00102   TeleoInterfaceInt* teleoInterfaceP = (TeleoInterfaceInt*)ti;
00103 
00104   <span class="keywordflow">if</span> ( teleoInterfaceP == NULL || name == NULL )
00105     <span class="keywordflow">return</span> <a class="code" href="TeleoError_8h.html#a20a9">TELEO_E_NULL_POINTER</a>;
00106 
00107   *name = teleoInterfaceP-&gt;<a class="code" href="structTeleoInterfaceInt.html#m2">name</a>;
00108 
00109   <span class="keywordflow">return</span> <a class="code" href="TeleoError_8h.html#a20a0">TELEO_OK</a>;
00110 }
00111 
<a name="l00112"></a><a class="code" href="TeleoInterfaceMacOSX_8c.html#a4">00112</a> <a class="code" href="TeleoError_8h.html#a20">TeleoError</a> <a class="code" href="TeleoInterfaceLinux_8c.html#a3">TI_typeGet</a>( <a class="code" href="structTeleoInterface.html">TeleoInterface</a>* ti, cchar** type )
00113 {
00114   TeleoInterfaceInt* teleoInterfaceP = (TeleoInterfaceInt*)ti;
00115 
00116   <span class="keywordflow">if</span> ( teleoInterfaceP == NULL || type == NULL )
00117     <span class="keywordflow">return</span> <a class="code" href="TeleoError_8h.html#a20a9">TELEO_E_NULL_POINTER</a>;
00118 
00119   <span class="keywordflow">switch</span> ( teleoInterfaceP-&gt;<a class="code" href="structTeleoInterfaceInt.html#m1">interfaceType</a> )
00120   {
00121     <span class="keywordflow">case</span> <a class="code" href="TeleoInterface_8h.html#a21a0">TI_USB</a>:
00122       *type = <span class="stringliteral">"usb"</span>;
00123       <span class="keywordflow">break</span>;
00124     <span class="keywordflow">case</span> <a class="code" href="TeleoInterface_8h.html#a21a5">TI_SERIAL</a>:
00125       *type = <span class="stringliteral">"ser"</span>;
00126       <span class="keywordflow">break</span>;
00127     <span class="keywordflow">case</span> <a class="code" href="TeleoInterface_8h.html#a21a10">TI_NETWORK</a>:
00128       *type = <span class="stringliteral">"net"</span>;
00129       <span class="keywordflow">break</span>;
00130     <span class="keywordflow">default</span>:
00131       *type = <span class="stringliteral">"?"</span>;
00132   }
00133 
00134   <span class="keywordflow">return</span> <a class="code" href="TeleoError_8h.html#a20a0">TELEO_OK</a>;
00135 }
00136 
<a name="l00137"></a><a class="code" href="TeleoInterfaceMacOSX_8c.html#a5">00137</a> <a class="code" href="TeleoError_8h.html#a20">TeleoError</a> <a class="code" href="TeleoInterfaceLinux_8c.html#a4">TI_blockingSet</a>( <a class="code" href="structTeleoInterface.html">TeleoInterface</a>* ti, <span class="keywordtype">bool</span> blocking )
00138 {
00139   TeleoInterfaceInt* teleoInterfaceP = (TeleoInterfaceInt*)ti;
00140   <span class="keywordflow">if</span> ( teleoInterfaceP == NULL )
00141     <span class="keywordflow">return</span> ( TELEO_E_NULL_POINTER );
00142 
00143   teleoInterfaceP-&gt;<a class="code" href="structTeleoInterfaceInt.html#m4">blocking</a> = blocking;
00144 }
00145 
<a name="l00146"></a><a class="code" href="TeleoInterfaceMacOSX_8c.html#a6">00146</a> <a class="code" href="TeleoError_8h.html#a20">TeleoError</a> <a class="code" href="TeleoInterfaceLinux_8c.html#a5">TI_open</a>( <a class="code" href="structTeleoInterface.html">TeleoInterface</a>* ti )
00147 {
00148   TeleoInterfaceInt* teleoInterfaceP = (TeleoInterfaceInt*)ti;
00149 
00150   <span class="comment">// is there a structure?</span>
00151   <span class="keywordflow">if</span> ( !teleoInterfaceP )
00152     <span class="keywordflow">return</span>( TELEO_E_NULL_POINTER );
00153   
00154   <span class="comment">// is there a pointer to the device name?</span>
00155   <span class="keywordflow">if</span> (!teleoInterfaceP-&gt;<a class="code" href="structTeleoInterfaceInt.html#m2">name</a>)
00156     <span class="keywordflow">return</span>( TELEO_E_NULL_POINTER );
00157 
00158   <span class="comment">// Open the port</span>
00159   teleoInterfaceP-&gt;<a class="code" href="structTeleoInterfaceInt.html#m3">deviceHandle</a> = open( teleoInterfaceP-&gt;<a class="code" href="structTeleoInterfaceInt.html#m2">name</a>, O_RDWR | O_NOCTTY | ( ( teleoInterfaceP-&gt;<a class="code" href="structTeleoInterfaceInt.html#m4">blocking</a> ) ? 0 : O_NDELAY ) );
00160   <span class="keywordflow">if</span> ( teleoInterfaceP-&gt;<a class="code" href="structTeleoInterfaceInt.html#m3">deviceHandle</a> &lt; 0 )
00161   {
00162     printf( <span class="stringliteral">"Could Not OPEN the port (Error %d)\n"</span>, teleoInterfaceP-&gt;<a class="code" href="structTeleoInterfaceInt.html#m3">deviceHandle</a> );
00163     <span class="keywordflow">return</span> ( TELEO_E_OPEN );
00164   }
00165   <span class="keywordflow">else</span>
00166   {
00167     <span class="comment">//if ( teleoInterfaceP-&gt;interfaceType == TI_SERIAL )</span>
00168     {
00169       tcgetattr( teleoInterfaceP-&gt;<a class="code" href="structTeleoInterfaceInt.html#m3">deviceHandle</a> ,&amp;teleoInterfaceP-&gt;<a class="code" href="structTeleoInterfaceInt.html#m6">terminalSettingsOld</a> ); 
00170       bzero( &amp;teleoInterfaceP-&gt;<a class="code" href="structTeleoInterfaceInt.html#m5">terminalSettings</a>, <span class="keyword">sizeof</span>( teleoInterfaceP-&gt;<a class="code" href="structTeleoInterfaceInt.html#m5">terminalSettings</a> ) );
00171     
00172       teleoInterfaceP-&gt;<a class="code" href="structTeleoInterfaceInt.html#m5">terminalSettings</a>.c_cflag = B115200 | CS8 | CREAD | CRTSCTS;
00173       teleoInterfaceP-&gt;<a class="code" href="structTeleoInterfaceInt.html#m5">terminalSettings</a>.c_iflag = IGNPAR;
00174       teleoInterfaceP-&gt;<a class="code" href="structTeleoInterfaceInt.html#m5">terminalSettings</a>.c_oflag = 0;
00175       teleoInterfaceP-&gt;<a class="code" href="structTeleoInterfaceInt.html#m5">terminalSettings</a>.c_lflag = 0;
00176   
00177       <span class="keywordflow">if</span> ( teleoInterfaceP-&gt;<a class="code" href="structTeleoInterfaceInt.html#m4">blocking</a> )
00178       {
00179         teleoInterfaceP-&gt;<a class="code" href="structTeleoInterfaceInt.html#m5">terminalSettings</a>.c_cc[VTIME]    = 0;   <span class="comment">/* inter-character timer unused */</span>
00180         teleoInterfaceP-&gt;<a class="code" href="structTeleoInterfaceInt.html#m5">terminalSettings</a>.c_cc[VMIN]     = 1;   <span class="comment">/* blocking read until 5 chars received */</span>
00181       }
00182     
00183       tcflush( teleoInterfaceP-&gt;<a class="code" href="structTeleoInterfaceInt.html#m3">deviceHandle</a>, TCIFLUSH );
00184       tcsetattr( teleoInterfaceP-&gt;<a class="code" href="structTeleoInterfaceInt.html#m3">deviceHandle</a>, TCSANOW, &amp;teleoInterfaceP-&gt;<a class="code" href="structTeleoInterfaceInt.html#m5">terminalSettings</a> );
00185     }
00186   }
00187 
00188   <span class="keywordflow">return</span> <a class="code" href="TeleoError_8h.html#a20a0">TELEO_OK</a>;
00189 }
00190  
<a name="l00191"></a><a class="code" href="TeleoInterfaceMacOSX_8c.html#a7">00191</a> <a class="code" href="TeleoError_8h.html#a20">TeleoError</a> <a class="code" href="TeleoInterfaceLinux_8c.html#a6">TI_close</a>( <a class="code" href="structTeleoInterface.html">TeleoInterface</a>* ti )
00192 {
00193   TeleoInterfaceInt* teleoInterfaceP = (TeleoInterfaceInt*)ti;
00194   
00195   <span class="comment">// is there a structure?</span>
00196   <span class="keywordflow">if</span> ( !teleoInterfaceP )
00197     <span class="keywordflow">return</span>( TELEO_E_NULL_POINTER );
00198 
00199   <span class="comment">// should put the terminal settings back now, I guess</span>
00200   <span class="comment">// ...</span>
00201   
00202   close( teleoInterfaceP-&gt;<a class="code" href="structTeleoInterfaceInt.html#m3">deviceHandle</a> );
00203 
00204   teleoInterfaceP-&gt;<a class="code" href="structTeleoInterfaceInt.html#m3">deviceHandle</a> = -1;
00205 
00206   <span class="keywordflow">return</span> <a class="code" href="TeleoError_8h.html#a20a0">TELEO_OK</a>;
00207 }
00208 
00209 <span class="comment">//</span>
00210 <span class="comment">// asks the serial port for a char</span>
00211 <span class="comment">// returns TELEO_OK if a char is returned</span>
00212 <span class="comment">// returns TELEO_E_NOTHING if there is no char</span>
00213 <span class="comment">// returns TELEO_E_UNKNOWN otherwise</span>
00214 <span class="comment">//</span>
<a name="l00215"></a><a class="code" href="TeleoInterfaceMacOSX_8c.html#a8">00215</a> <a class="code" href="TeleoError_8h.html#a20">TeleoError</a> <a class="code" href="TeleoInterfaceLinux_8c.html#a7">TI_get</a>( <a class="code" href="structTeleoInterface.html">TeleoInterface</a>* ti, uint8* cp, <span class="keywordtype">int</span> countIn )
00216 {
00217   <span class="keywordtype">int</span> count;
00218   
00219   TeleoInterfaceInt* teleoInterfaceP = (TeleoInterfaceInt*)ti;
00220   <span class="comment">// is there a structure?</span>
00221   <span class="keywordflow">if</span> ( !teleoInterfaceP )
00222     <span class="keywordflow">return</span>( TELEO_E_NULL_POINTER );
00223 
00224   count = read( (<span class="keywordtype">int</span>)teleoInterfaceP-&gt;<a class="code" href="structTeleoInterfaceInt.html#m3">deviceHandle</a>, cp, 1 );
00225   
00226   <span class="keywordflow">switch</span> ( count )
00227   {
00228     <span class="keywordflow">case</span> 0:
00229       <span class="keywordflow">if</span> ( teleoInterfaceP-&gt;<a class="code" href="structTeleoInterfaceInt.html#m4">blocking</a> )
00230         printf( <span class="stringliteral">"Closed Errno = %d\n"</span>, errno );
00231       <span class="keywordflow">return</span> (TELEO_E_NOTHING);
00232     <span class="keywordflow">case</span> 1:
00233       <span class="comment">// got a character</span>
00234       <span class="keywordflow">return</span> (TELEO_OK);
00235     <span class="keywordflow">case</span> -1:
00236       <span class="comment">// no character waiting</span>
00237       <span class="comment">//printf( "Errno = %d", errno );</span>
00238       <span class="keywordflow">return</span> (TELEO_E_UNKNOWN);
00239     <span class="keywordflow">default</span>:
00240       <span class="comment">//printf( "DeF Errno = %d", errno );</span>
00241       <span class="comment">// dunno what this could be</span>
00242       <span class="keywordflow">return</span> (TELEO_E_UNKNOWN);
00243   }
00244 }
00245 
<a name="l00246"></a><a class="code" href="TeleoInterfaceMacOSX_8c.html#a9">00246</a> <a class="code" href="TeleoError_8h.html#a20">TeleoError</a> <a class="code" href="TeleoInterfaceLinux_8c.html#a8">TI_put</a>( <a class="code" href="structTeleoInterface.html">TeleoInterface</a>* ti, uint8* cp, <span class="keywordtype">int</span> count )
00247 {
00248   TeleoInterfaceInt* teleoInterfaceP = (TeleoInterfaceInt*)ti;
00249   <span class="comment">// is there a structure?</span>
00250   <span class="keywordflow">if</span> ( !teleoInterfaceP )
00251     <span class="keywordflow">return</span>( TELEO_E_NULL_POINTER );
00252   
00253   <span class="keywordflow">if</span> ( write( teleoInterfaceP-&gt;<a class="code" href="structTeleoInterfaceInt.html#m3">deviceHandle</a>, cp, count ) == count )
00254     <span class="keywordflow">return</span> <a class="code" href="TeleoError_8h.html#a20a0">TELEO_OK</a>;
00255   <span class="keywordflow">else</span>
00256   {
00257     <span class="comment">//printf( "Message Send Failed\n" );</span>
00258     <span class="keywordflow">return</span> <a class="code" href="TeleoError_8h.html#a20a8">TELEO_E_IO</a>;
00259   }
00260 }
00261 
<a name="l00262"></a><a class="code" href="TeleoInterfaceMacOSX_8c.html#a10">00262</a> <a class="code" href="TeleoError_8h.html#a20">TeleoError</a> <a class="code" href="TeleoInterfaceLinux_8c.html#a9">TI_SleepMs</a>( <span class="keywordtype">long</span> ms )
00263 {
00264     usleep( 1000*ms );
00265       <span class="keywordflow">return</span> <a class="code" href="TeleoError_8h.html#a20a0">TELEO_OK</a>;
00266 }
00267 
<a name="l00268"></a><a class="code" href="TeleoInterfaceMacOSX_8c.html#a0">00268</a> <span class="keyword">static</span> <a class="code" href="TeleoError_8h.html#a20">TeleoError</a> <a class="code" href="TeleoModuleMacOSX_8c.html#a12">TI_FindUsbSerialDevice</a>(cchar** dest, <span class="keywordtype">int</span> index)
00269 {
00270   <span class="keyword">struct </span>dirent **namelist;
00271   <span class="keywordtype">int</span> n;
00272   <span class="keywordtype">char</span>* tempName;
00273 
00274   n = scandir(<span class="stringliteral">"/dev"</span>, &amp;namelist, matchUsbSerialDevice, NULL);
00275   <span class="keywordflow">if</span> (n &lt; 0)
00276   {
00277     perror(<span class="stringliteral">"scandir"</span>);
00278     <span class="keywordflow">return</span>(TELEO_E_UNKNOWN);
00279   }
00280   <span class="keywordflow">if</span> (n &lt; index+1)
00281   {
00282     <span class="keywordflow">return</span>(TELEO_E_UNKNOWN);
00283   }
00284   tempName = (<span class="keywordtype">char</span> * ) malloc( <span class="keyword">sizeof</span> ( namelist[index]-&gt;d_name ) + 
00285                                  <span class="keyword">sizeof</span> ( <span class="stringliteral">"/dev/"</span> ) );
00286   <span class="keywordflow">if</span> (!tempName) 
00287     <span class="keywordflow">return</span> <a class="code" href="TeleoError_8h.html#a20a16">TELEO_E_ALLOC</a>;
00288   strcpy(tempName, <span class="stringliteral">"/dev/"</span>);
00289   strcat(tempName, namelist[index]-&gt;d_name);
00290 
00291   <span class="keywordflow">for</span> (;n;n--)
00292     free(namelist[n]);
00293   free(namelist);
00294 
00295   *dest = tempName;
00296   <span class="keywordflow">return</span>(TELEO_OK);
00297 }
00298 
<a name="l00299"></a><a class="code" href="TeleoInterfaceMacOSX_8c.html#a1">00299</a> <span class="keywordtype">int</span>  <a class="code" href="TeleoModuleMacOSX_8c.html#a13">matchUsbSerialDevice</a> (<span class="keyword">struct</span> dirent * tryThis)
00300 {
00301   <span class="keywordflow">if</span> (strncmp(<span class="stringliteral">"tty.usbserial-"</span>, 
00302                     tryThis-&gt;d_name, 
00303                     strlen(<span class="stringliteral">"tty.usbserial-"</span>)))
00304     <span class="keywordflow">return</span> 0;
00305   <span class="keywordflow">else</span>
00306     <span class="keywordflow">return</span> 1;
00307 }
</pre></div></font>
<p>&nbsp;</p> 
<table width="100%">
  <tr>
    <td colspan="2" bgcolor="395e7a"> 
      <p align="center"><font color="#FFFFFF" class="small">copyright &copy; 2002, 2003 
        MakingThings LLC</font></p>
    </td>
  </tr>
</table>
 
<p>&nbsp;</p> 
</body>
</html>
