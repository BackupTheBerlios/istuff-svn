<html>
<head>
 
<title>TELEO APPLICATION SDK</title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<link rel="stylesheet" href="code.css" type="text/css">
</head>

<body bgcolor="#FFFFFF" text="#000000" link="619ec3" vlink="619ec3" alink="619ec3">

<table width="100%" border="0" cellspacing="0" cellpadding="-1">
  <tr> 
    <td width="1%" rowspan="2" bgcolor="#FFFFFF" valign="top"><a href="/index.htm"><img src="images/logo_header_blue.jpg" width="263" height="123" border="0"></a></td>
    <td height="109" bgcolor="395e7a" width="100%" valign="bottom" align="left"> 
      <p>&nbsp;</p>
      <table width="100%" border="0">
        <tr> 
          <td width="20%" height="20" class="medium_bold"> 
            <div align="center">
              <font color="619ec3" class="medium_bold"><a href="http://www.makingthings.com/home.htm">HOME</a></font>
            </div>
          </td>
          <td width="20%" height="20" class="medium_bold"> 
            <div align="center"><font color="619ec3" class="medium_bold"><a href="http://www.makingthings.com/projects.htm">PROJECTS</a></font></div>
          </td>
          <td width="20%" height="20" class="medium_bold"> 
            <div align="center"><font color="#FFFFFF" class="medium_bold"><b class="medium_bold">PRODUCTS</b></font></div>
          </td>
          <td width="20%" class="medium_bold" height="20"> 
            <div align="center"><font color="619ec3" class="medium_bold"><a href="http://www.makingthings.com/services.htm">SERVICES</a></font></div>
          </td>
          <td width="20%" class="medium_bold" height="20"> 
            <div align="center"><font color="619ec3" class="medium_bold"><a href="http://www.makingthings.com/news/news.htm">NEWS</a></font></div>
          </td>
        </tr>
      </table>
    </td>
  </tr>
  <tr> 
    <td width="100%" height="15">&nbsp;</td>
  </tr>
  <tr align="left" valign="middle"> 
    <td colspan="2"></td>
  </tr>
</table> 
<br>
<hr>

<font face="Arial, Helvetica, sans-serif" size="2">


<!-- Generated by Doxygen 1.3-rc3 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="annotated.html">Data Structures</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Data Fields</a> &nbsp; <a class="qindex" href="globals.html">Globals</a> &nbsp; </center>
<hr><h1>TeleoInterfaceWin32.c</h1><a href="TeleoInterfaceWin32_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">/* Copyright 2003 MakingThings LLC. */</span>
00002 
00007 <span class="preprocessor">#include "<a class="code" href="TeleoInterface_8h.html">TeleoInterface.h</a>"</span>
00008 
00009 <span class="preprocessor">#include &lt;windows.h&gt;</span>
00010 
00011 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
00012 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
00013 <span class="preprocessor">#include &lt;string.h&gt;</span>
00014 
00019 <span class="keyword">typedef</span> <span class="keyword">struct </span>
00020 <span class="keyword"></span>{
<a name="l00021"></a><a class="code" href="structTeleoInterfaceInt.html#m0">00021</a>   <a class="code" href="structTeleoInterface.html">TeleoInterface</a> t;
00022   
<a name="l00023"></a><a class="code" href="structTeleoInterfaceInt.html#m1">00023</a>   <a class="code" href="TeleoInterface_8h.html#a21">TI_InterfaceType</a> interfaceType;  
<a name="l00024"></a><a class="code" href="structTeleoInterfaceInt.html#m10">00024</a>   <span class="keywordtype">char</span> * name;                     
00025   
<a name="l00026"></a><a class="code" href="structTeleoInterfaceInt.html#m11">00026</a>   HANDLE deviceHandle;             
00027   
<a name="l00028"></a><a class="code" href="structTeleoInterfaceInt.html#m4">00028</a>   <span class="keywordtype">bool</span> blocking;                   
00029 
00030   <span class="comment">// (ultimately) Union of all the different support data structures</span>
00031 
00032 } <a class="code" href="structTeleoInterfaceInt.html">TeleoInterfaceInt</a>;
00033 
<a name="l00034"></a><a class="code" href="TeleoInterfaceWin32_8c.html#a0">00034</a> <a class="code" href="TeleoError_8h.html#a20">TeleoError</a> <a class="code" href="TeleoInterfaceLinux_8c.html#a0">TI_Create</a>( cchar* name, TI_InterfaceType interfaceType, <a class="code" href="structTeleoInterface.html">TeleoInterface</a>** ti )
00035 {
00036   <a class="code" href="structTeleoInterfaceInt.html">TeleoInterfaceInt</a>* teleoInterfaceP;
00037 
00038   *ti = NULL;
00039   
00040   teleoInterfaceP = (<a class="code" href="structTeleoInterfaceInt.html">TeleoInterfaceInt</a>*)malloc( <span class="keyword">sizeof</span>( <a class="code" href="structTeleoInterfaceInt.html">TeleoInterfaceInt</a> ) );
00041   <span class="keywordflow">if</span> ( teleoInterfaceP == NULL )
00042     <span class="keywordflow">return</span> <a class="code" href="TeleoError_8h.html#a20a16">TELEO_E_ALLOC</a>;
00043   memset( teleoInterfaceP, 0, <span class="keyword">sizeof</span>( <a class="code" href="structTeleoInterfaceInt.html">TeleoInterfaceInt</a> ) );
00044 
00045   <span class="keywordflow">if</span> ( name == NULL )
00046   {
00047     <span class="keywordflow">switch</span> ( interfaceType )
00048     {
00049       <span class="keywordflow">case</span> <a class="code" href="TeleoInterface_8h.html#a21a0">TI_USB</a>:
00050       <span class="keywordflow">case</span> <a class="code" href="TeleoInterface_8h.html#a21a1">TI_USB0</a>:
00051       <span class="keywordflow">case</span> <a class="code" href="TeleoInterface_8h.html#a21a5">TI_SERIAL</a>:
00052       <span class="keywordflow">case</span> <a class="code" href="TeleoInterface_8h.html#a21a6">TI_SERIAL0</a>:
00053         teleoInterfaceP-&gt;<a class="code" href="structTeleoInterfaceInt.html#m2">name</a> = <span class="stringliteral">"COM1"</span>;
00054         <span class="keywordflow">break</span>;
00055       <span class="keywordflow">case</span> <a class="code" href="TeleoInterface_8h.html#a21a2">TI_USB1</a>:
00056       <span class="keywordflow">case</span> <a class="code" href="TeleoInterface_8h.html#a21a7">TI_SERIAL1</a>:
00057         teleoInterfaceP-&gt;<a class="code" href="structTeleoInterfaceInt.html#m2">name</a> = <span class="stringliteral">"COM2"</span>;
00058         <span class="keywordflow">break</span>;
00059       <span class="keywordflow">case</span> <a class="code" href="TeleoInterface_8h.html#a21a3">TI_USB2</a>:
00060       <span class="keywordflow">case</span> <a class="code" href="TeleoInterface_8h.html#a21a8">TI_SERIAL2</a>:
00061         teleoInterfaceP-&gt;<a class="code" href="structTeleoInterfaceInt.html#m2">name</a> = <span class="stringliteral">"COM3"</span>;
00062         <span class="keywordflow">break</span>;
00063       <span class="keywordflow">case</span> <a class="code" href="TeleoInterface_8h.html#a21a10">TI_NETWORK</a>:
00064         teleoInterfaceP-&gt;<a class="code" href="structTeleoInterfaceInt.html#m2">name</a> = <span class="stringliteral">""</span>;
00065         <span class="keywordflow">break</span>;
00066       <span class="keywordflow">default</span>:
00067         teleoInterfaceP-&gt;<a class="code" href="structTeleoInterfaceInt.html#m2">name</a> = <span class="stringliteral">""</span>;
00068     }
00069   }
00070   <span class="keywordflow">else</span>
00071   {
00072     <span class="keywordflow">if</span> ( name != NULL )
00073       teleoInterfaceP-&gt;<a class="code" href="structTeleoInterfaceInt.html#m2">name</a> = strdup( name );
00074   }
00075 
00076   teleoInterfaceP-&gt;<a class="code" href="structTeleoInterfaceInt.html#m1">interfaceType</a> = interfaceType;
00077   
00078   teleoInterfaceP-&gt;<a class="code" href="structTeleoInterfaceInt.html#m4">blocking</a> = <span class="keyword">false</span>;
00079 
00080   *ti = (<a class="code" href="structTeleoInterface.html">TeleoInterface</a>*)teleoInterfaceP;
00081   <span class="keywordflow">return</span> <a class="code" href="TeleoError_8h.html#a20a0">TELEO_OK</a>;
00082 }
00083 
<a name="l00084"></a><a class="code" href="TeleoInterfaceWin32_8c.html#a1">00084</a> <a class="code" href="TeleoError_8h.html#a20">TeleoError</a> <a class="code" href="TeleoInterfaceLinux_8c.html#a1">TI_destroy</a>( <a class="code" href="structTeleoInterface.html">TeleoInterface</a>* ti )
00085 {
00086   <a class="code" href="structTeleoInterfaceInt.html">TeleoInterfaceInt</a>* teleoInterfaceP = (<a class="code" href="structTeleoInterfaceInt.html">TeleoInterfaceInt</a>*)ti;
00087   
00088   <a class="code" href="TeleoInterfaceLinux_8c.html#a6">TI_close</a>( ti );
00089 
00090   <span class="keywordflow">if</span> ( teleoInterfaceP-&gt;<a class="code" href="structTeleoInterfaceInt.html#m2">name</a> != NULL )
00091     free( teleoInterfaceP-&gt;<a class="code" href="structTeleoInterfaceInt.html#m2">name</a> );
00092 
00093   free( teleoInterfaceP );
00094 
00095   <span class="keywordflow">return</span> <a class="code" href="TeleoError_8h.html#a20a0">TELEO_OK</a>;
00096 }
00097 
<a name="l00098"></a><a class="code" href="TeleoInterfaceWin32_8c.html#a2">00098</a> <a class="code" href="TeleoError_8h.html#a20">TeleoError</a> <a class="code" href="TeleoInterfaceLinux_8c.html#a2">TI_nameGet</a>( <a class="code" href="structTeleoInterface.html">TeleoInterface</a>* ti, cchar** name )
00099 {
00100   <a class="code" href="structTeleoInterfaceInt.html">TeleoInterfaceInt</a>* teleoInterfaceP = (<a class="code" href="structTeleoInterfaceInt.html">TeleoInterfaceInt</a>*)ti;
00101 
00102   <span class="keywordflow">if</span> ( teleoInterfaceP == NULL || name == NULL )
00103     <span class="keywordflow">return</span> <a class="code" href="TeleoError_8h.html#a20a9">TELEO_E_NULL_POINTER</a>;
00104 
00105   *name = teleoInterfaceP-&gt;<a class="code" href="structTeleoInterfaceInt.html#m2">name</a>;
00106 
00107   <span class="keywordflow">return</span> <a class="code" href="TeleoError_8h.html#a20a0">TELEO_OK</a>;
00108 }
00109 
<a name="l00110"></a><a class="code" href="TeleoInterfaceWin32_8c.html#a3">00110</a> <a class="code" href="TeleoError_8h.html#a20">TeleoError</a> <a class="code" href="TeleoInterfaceLinux_8c.html#a3">TI_typeGet</a>( <a class="code" href="structTeleoInterface.html">TeleoInterface</a>* ti, cchar** type )
00111 {
00112   <a class="code" href="structTeleoInterfaceInt.html">TeleoInterfaceInt</a>* teleoInterfaceP = (<a class="code" href="structTeleoInterfaceInt.html">TeleoInterfaceInt</a>*)ti;
00113 
00114   <span class="keywordflow">if</span> ( teleoInterfaceP == NULL || type == NULL )
00115     <span class="keywordflow">return</span> <a class="code" href="TeleoError_8h.html#a20a9">TELEO_E_NULL_POINTER</a>;
00116 
00117   <span class="keywordflow">switch</span> ( teleoInterfaceP-&gt;<a class="code" href="structTeleoInterfaceInt.html#m1">interfaceType</a> )
00118   {
00119     <span class="keywordflow">case</span> <a class="code" href="TeleoInterface_8h.html#a21a0">TI_USB</a>:
00120     <span class="keywordflow">case</span> <a class="code" href="TeleoInterface_8h.html#a21a1">TI_USB0</a>:
00121       *type = <span class="stringliteral">"usb"</span>;
00122       <span class="keywordflow">break</span>;
00123     <span class="keywordflow">case</span> <a class="code" href="TeleoInterface_8h.html#a21a5">TI_SERIAL</a>:
00124     <span class="keywordflow">case</span> <a class="code" href="TeleoInterface_8h.html#a21a6">TI_SERIAL0</a>:
00125       *type = <span class="stringliteral">"ser"</span>;
00126       <span class="keywordflow">break</span>;
00127     <span class="keywordflow">case</span> <a class="code" href="TeleoInterface_8h.html#a21a2">TI_USB1</a>:
00128       *type = <span class="stringliteral">"usb1"</span>;
00129       <span class="keywordflow">break</span>;
00130     <span class="keywordflow">case</span> <a class="code" href="TeleoInterface_8h.html#a21a7">TI_SERIAL1</a>:
00131       *type = <span class="stringliteral">"ser1"</span>;
00132       <span class="keywordflow">break</span>;
00133     <span class="keywordflow">case</span> <a class="code" href="TeleoInterface_8h.html#a21a3">TI_USB2</a>:
00134       *type = <span class="stringliteral">"usb2"</span>;
00135       <span class="keywordflow">break</span>;
00136     <span class="keywordflow">case</span> <a class="code" href="TeleoInterface_8h.html#a21a8">TI_SERIAL2</a>:
00137       *type = <span class="stringliteral">"ser2"</span>;
00138       <span class="keywordflow">break</span>;
00139     <span class="keywordflow">case</span> <a class="code" href="TeleoInterface_8h.html#a21a10">TI_NETWORK</a>:
00140       *type = <span class="stringliteral">"net"</span>;
00141       <span class="keywordflow">break</span>;
00142     <span class="keywordflow">default</span>:
00143       *type = <span class="stringliteral">"?"</span>;
00144   }
00145 
00146   <span class="keywordflow">return</span> <a class="code" href="TeleoError_8h.html#a20a0">TELEO_OK</a>;
00147 }
00148 
<a name="l00149"></a><a class="code" href="TeleoInterfaceWin32_8c.html#a4">00149</a> <a class="code" href="TeleoError_8h.html#a20">TeleoError</a> <a class="code" href="TeleoInterfaceLinux_8c.html#a4">TI_blockingSet</a>( <a class="code" href="structTeleoInterface.html">TeleoInterface</a>* ti, <span class="keywordtype">bool</span> blocking )
00150 {
00151   <a class="code" href="structTeleoInterfaceInt.html">TeleoInterfaceInt</a>* teleoInterfaceP = (<a class="code" href="structTeleoInterfaceInt.html">TeleoInterfaceInt</a>*)ti;
00152   <span class="keywordflow">if</span> ( teleoInterfaceP == NULL )
00153     <span class="keywordflow">return</span> ( TELEO_E_NULL_POINTER );
00154 
00155   teleoInterfaceP-&gt;<a class="code" href="structTeleoInterfaceInt.html#m4">blocking</a> = blocking;
00156   <span class="keywordflow">return</span> <a class="code" href="TeleoError_8h.html#a20a0">TELEO_OK</a>;
00157 }
00158 
<a name="l00159"></a><a class="code" href="TeleoInterfaceWin32_8c.html#a5">00159</a> <a class="code" href="TeleoError_8h.html#a20">TeleoError</a> <a class="code" href="TeleoInterfaceLinux_8c.html#a5">TI_open</a>( <a class="code" href="structTeleoInterface.html">TeleoInterface</a>* ti )
00160 {
00161   <a class="code" href="structTeleoInterfaceInt.html">TeleoInterfaceInt</a>* teleoInterfaceP = (<a class="code" href="structTeleoInterfaceInt.html">TeleoInterfaceInt</a>*)ti;
00162   DCB dcb;
00163   COMMTIMEOUTS timeouts;
00164 
00165   <span class="comment">// is there a structure?</span>
00166   <span class="keywordflow">if</span> ( !teleoInterfaceP )
00167     <span class="keywordflow">return</span> <a class="code" href="TeleoError_8h.html#a20a9">TELEO_E_NULL_POINTER</a>;
00168   
00169   <span class="comment">// is there a pointer to the device name?</span>
00170   <span class="keywordflow">if</span> (!teleoInterfaceP-&gt;<a class="code" href="structTeleoInterfaceInt.html#m2">name</a>)
00171     <span class="keywordflow">return</span> <a class="code" href="TeleoError_8h.html#a20a9">TELEO_E_NULL_POINTER</a>;
00172 
00173   <span class="comment">// Open the port</span>
00174   teleoInterfaceP-&gt;<a class="code" href="structTeleoInterfaceInt.html#m3">deviceHandle</a> = CreateFile( teleoInterfaceP-&gt;<a class="code" href="structTeleoInterfaceInt.html#m2">name</a>, GENERIC_READ | GENERIC_WRITE, 0, 0, OPEN_EXISTING, FILE_ATTRIBUTE_NORMAL, 0 );
00175   <span class="comment">//| ( ( teleoInterfaceP-&gt;blocking ) ? 0 : O_NDELAY ) );</span>
00176   <span class="keywordflow">if</span> ( teleoInterfaceP-&gt;<a class="code" href="structTeleoInterfaceInt.html#m3">deviceHandle</a> == INVALID_HANDLE_VALUE )
00177   {
00178     <span class="comment">// printf( "Could Not OPEN the port %s (Error %d)\r\n", teleoInterfaceP-&gt;name, GetLastError() );</span>
00179     <span class="keywordflow">return</span> <a class="code" href="TeleoError_8h.html#a20a10">TELEO_E_OPEN</a>;
00180   }
00181   <span class="keywordflow">else</span>
00182   {
00183     <span class="comment">// printf( "Port %s Open\r\n", teleoInterfaceP-&gt;name );</span>
00184 
00185     GetCommState( teleoInterfaceP-&gt;<a class="code" href="structTeleoInterfaceInt.html#m3">deviceHandle</a>, &amp;dcb );
00186 
00187     dcb.BaudRate = CBR_115200;
00188     dcb.ByteSize = 8;
00189     dcb.Parity = NOPARITY;
00190     dcb.StopBits = ONESTOPBIT;
00191     dcb.fOutxCtsFlow = TRUE;
00192     dcb.fRtsControl = RTS_CONTROL_HANDSHAKE;
00193 
00194     SetCommState( teleoInterfaceP-&gt;<a class="code" href="structTeleoInterfaceInt.html#m3">deviceHandle</a>, &amp;dcb );
00195 
00196     <span class="keywordflow">if</span> ( teleoInterfaceP-&gt;<a class="code" href="structTeleoInterfaceInt.html#m4">blocking</a> )
00197       timeouts.ReadIntervalTimeout = 0;
00198     <span class="keywordflow">else</span>
00199       timeouts.ReadIntervalTimeout = MAXDWORD;
00200 
00201     timeouts.ReadTotalTimeoutMultiplier = 0;
00202     timeouts.ReadTotalTimeoutConstant = 0;
00203     timeouts.WriteTotalTimeoutMultiplier = 0;
00204     timeouts.WriteTotalTimeoutConstant = 0;
00205     
00206     SetCommTimeouts( teleoInterfaceP-&gt;<a class="code" href="structTeleoInterfaceInt.html#m3">deviceHandle</a>, &amp;timeouts );
00207 
00208     EscapeCommFunction( teleoInterfaceP-&gt;<a class="code" href="structTeleoInterfaceInt.html#m3">deviceHandle</a>, SETDTR );
00209 
00210     <span class="comment">//if ( teleoInterfaceP-&gt;interfaceType == TI_SERIAL )</span>
00211 <span class="comment">/*</span>
00212 <span class="comment">    {</span>
00213 <span class="comment">      tcgetattr( teleoInterfaceP-&gt;deviceHandle ,&amp;teleoInterfaceP-&gt;terminalSettingsOld ); </span>
00214 <span class="comment">      bzero( &amp;teleoInterfaceP-&gt;terminalSettings, sizeof( teleoInterfaceP-&gt;terminalSettings ) );</span>
00215 <span class="comment">    </span>
00216 <span class="comment">      teleoInterfaceP-&gt;terminalSettings.c_cflag = B115200 | CS8 | CREAD | CRTSCTS;</span>
00217 <span class="comment">      teleoInterfaceP-&gt;terminalSettings.c_iflag = IGNPAR;</span>
00218 <span class="comment">      teleoInterfaceP-&gt;terminalSettings.c_oflag = 0;</span>
00219 <span class="comment">      teleoInterfaceP-&gt;terminalSettings.c_lflag = 0;</span>
00220 <span class="comment">  </span>
00221 <span class="comment">      if ( teleoInterfaceP-&gt;blocking )</span>
00222 <span class="comment">      {</span>
00223 <span class="comment">        teleoInterfaceP-&gt;terminalSettings.c_cc[VTIME]    = 0;   //   inter-character timer unused</span>
00224 <span class="comment">        teleoInterfaceP-&gt;terminalSettings.c_cc[VMIN]     = 1;   // blocking read until 5 chars received</span>
00225 <span class="comment">      }</span>
00226 <span class="comment">    </span>
00227 <span class="comment">      tcflush( teleoInterfaceP-&gt;deviceHandle, TCIFLUSH );</span>
00228 <span class="comment">      tcsetattr( teleoInterfaceP-&gt;deviceHandle, TCSANOW, &amp;teleoInterfaceP-&gt;terminalSettings );</span>
00229 <span class="comment">    }</span>
00230 <span class="comment">*/</span>
00231   }
00232 
00233   <span class="keywordflow">return</span> <a class="code" href="TeleoError_8h.html#a20a0">TELEO_OK</a>;
00234 }
00235  
<a name="l00236"></a><a class="code" href="TeleoInterfaceWin32_8c.html#a6">00236</a> <a class="code" href="TeleoError_8h.html#a20">TeleoError</a> <a class="code" href="TeleoInterfaceLinux_8c.html#a6">TI_close</a>( <a class="code" href="structTeleoInterface.html">TeleoInterface</a>* ti )
00237 {
00238   <a class="code" href="structTeleoInterfaceInt.html">TeleoInterfaceInt</a>* teleoInterfaceP = (<a class="code" href="structTeleoInterfaceInt.html">TeleoInterfaceInt</a>*)ti;
00239   
00240   <span class="comment">// is there a structure?</span>
00241   <span class="keywordflow">if</span> ( !teleoInterfaceP )
00242     <span class="keywordflow">return</span>( TELEO_E_NULL_POINTER );
00243 
00244   <span class="comment">// should put the terminal settings back now, I guess</span>
00245   <span class="comment">// ...</span>
00246   
00247   CloseHandle( teleoInterfaceP-&gt;<a class="code" href="structTeleoInterfaceInt.html#m3">deviceHandle</a> );
00248 
00249   teleoInterfaceP-&gt;<a class="code" href="structTeleoInterfaceInt.html#m3">deviceHandle</a> = INVALID_HANDLE_VALUE;
00250 
00251   <span class="keywordflow">return</span> <a class="code" href="TeleoError_8h.html#a20a0">TELEO_OK</a>;
00252 }
00253 
00254 <span class="comment">//</span>
00255 <span class="comment">// asks the serial port for a char</span>
00256 <span class="comment">// returns TELEO_OK if a char is returned</span>
00257 <span class="comment">// returns TELEO_E_NOTHING if there is no char</span>
00258 <span class="comment">// returns TELEO_E_UNKNOWN otherwise</span>
00259 <span class="comment">//</span>
<a name="l00260"></a><a class="code" href="TeleoInterfaceWin32_8c.html#a7">00260</a> <a class="code" href="TeleoError_8h.html#a20">TeleoError</a> <a class="code" href="TeleoInterfaceLinux_8c.html#a7">TI_get</a>( <a class="code" href="structTeleoInterface.html">TeleoInterface</a>* ti, uint8* cp, <span class="keywordtype">int</span> countIn )
00261 {
00262   <span class="keywordtype">int</span> count;
00263   
00264   <a class="code" href="structTeleoInterfaceInt.html">TeleoInterfaceInt</a>* teleoInterfaceP = (<a class="code" href="structTeleoInterfaceInt.html">TeleoInterfaceInt</a>*)ti;
00265   <span class="comment">// is there a structure?</span>
00266   <span class="keywordflow">if</span> ( !teleoInterfaceP )
00267     <span class="keywordflow">return</span>( TELEO_E_NULL_POINTER );
00268 
00269   <span class="keywordflow">if</span> ( !ReadFile( teleoInterfaceP-&gt;<a class="code" href="structTeleoInterfaceInt.html#m3">deviceHandle</a>, cp, 1, &amp;count, 0 ) )
00270   {
00271     <span class="comment">//printf( "no char\r\n" );</span>
00272     <span class="keywordflow">return</span> <a class="code" href="TeleoError_8h.html#a20a1">TELEO_E_NOTHING</a>;
00273   }
00274   <span class="keywordflow">else</span>
00275   {
00276     <span class="comment">//printf( "char %c\r\n", *cp );</span>
00277     <span class="keywordflow">return</span> (TELEO_OK);
00278   }
00279 }
00280 
<a name="l00281"></a><a class="code" href="TeleoInterfaceWin32_8c.html#a8">00281</a> <a class="code" href="TeleoError_8h.html#a20">TeleoError</a> <a class="code" href="TeleoInterfaceLinux_8c.html#a8">TI_put</a>( <a class="code" href="structTeleoInterface.html">TeleoInterface</a>* ti, uint8* cp, <span class="keywordtype">int</span> count )
00282 {
00283   <a class="code" href="structTeleoInterfaceInt.html">TeleoInterfaceInt</a>* teleoInterfaceP = (<a class="code" href="structTeleoInterfaceInt.html">TeleoInterfaceInt</a>*)ti;
00284   <span class="keywordtype">int</span> cout;
00285 
00286   <span class="comment">// is there a structure?</span>
00287   <span class="keywordflow">if</span> ( !teleoInterfaceP )
00288     <span class="keywordflow">return</span>( TELEO_E_NULL_POINTER );
00289   
00290   <span class="keywordflow">if</span> ( !WriteFile( teleoInterfaceP-&gt;<a class="code" href="structTeleoInterfaceInt.html#m3">deviceHandle</a>, cp, count, &amp;cout, 0 ) )
00291     <span class="keywordflow">return</span> <a class="code" href="TeleoError_8h.html#a20a8">TELEO_E_IO</a>;
00292   <span class="keywordflow">else</span>
00293     <span class="keywordflow">return</span> <a class="code" href="TeleoError_8h.html#a20a0">TELEO_OK</a>;
00294 }
00295 
<a name="l00296"></a><a class="code" href="TeleoInterfaceWin32_8c.html#a9">00296</a> <a class="code" href="TeleoError_8h.html#a20">TeleoError</a> <a class="code" href="TeleoInterfaceLinux_8c.html#a9">TI_SleepMs</a>( <span class="keywordtype">long</span> ms )
00297 {
00298   Sleep( ms );
00299   <span class="keywordflow">return</span> <a class="code" href="TeleoError_8h.html#a20a0">TELEO_OK</a>;
00300 }
</pre></div></font>
<p>&nbsp;</p> 
<table width="100%">
  <tr>
    <td colspan="2" bgcolor="395e7a"> 
      <p align="center"><font color="#FFFFFF" class="small">copyright &copy; 2002, 2003 
        MakingThings LLC</font></p>
    </td>
  </tr>
</table>
 
<p>&nbsp;</p> 
</body>
</html>
